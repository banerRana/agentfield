#!/usr/bin/env python3
"""Minimal {{.ProjectName}} agent generated on {{.CreatedAt}}."""

from __future__ import annotations

import os
from datetime import datetime

from brain_sdk import Agent, AgentRouter

# Start the Brain control plane first: `brain dev`.
# Then launch this node via `brain run {{.ProjectName}}` (or use the __main__ block below).
# Feel free to rename this to whatever you call the agent in Brain.
app = Agent(
    node_id="{{.NodeID}}",
    brain_server=os.getenv("BRAIN_SERVER_URL", "http://localhost:8080"),
    dev_mode=True,
)

# Group related reasoners and skills without touching FastAPI internals.
quickstart = AgentRouter(prefix="quickstart", tags=["example"])


@quickstart.reasoner()
async def summarize_notes(notes: str) -> dict:
    """Return a quick mock summary so you can run without credentials."""
    summary = {
        "summary": notes if len(notes) < 60 else f"{notes[:57]}...",
        "generated_at": datetime.utcnow().isoformat(timespec="seconds") + "Z",
        "source": "mock",
    }

    # Uncomment to use your own model once ready:
    # summary["summary"] = await quickstart.ai(
    #     system="You turn rough bullets into a concise update.",
    #     user=notes,
    # )

    return summary


@quickstart.reasoner()
async def ask_commented_ai(question: str) -> dict:
    """Show how to call a second agent; returns placeholder data by default."""
    # Example multi-agent hop (requires a running commented.ai node):
    # response = await quickstart.call(
    #     "commented-ai.answer_question",
    #     question=question,
    # )
    # return {"question": question, "agent_answer": response}

    return {
        "question": question,
        "agent_answer": "Set up commented.ai and uncomment the call() example to use it.",
    }


@quickstart.skill(tags=["utility"])
def current_timestamp() -> dict:
    """Deterministic helper so you can see skills vs. reasoners."""
    now = datetime.utcnow()
    return {
        "timestamp": now.isoformat(timespec="seconds") + "Z",
        "epoch": int(now.timestamp()),
    }


# Register everything under /reasoners/quickstart/* and /skills/quickstart/*.
app.include_router(quickstart)


if __name__ == "__main__":
    print("ğŸš€ Starting agent â€” Ctrl+C to stop")
    print("â„¹ï¸  Prefer `brain run {{.ProjectName}}` for automatic registration and restarts.")
    app.serve(auto_port=True, host="0.0.0.0")
